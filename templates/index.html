<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrustLens | National Threat Intelligence</title>
    <style>
        :root { --primary: #00f2ea; --bg: #0b0c10; --card: #1f2833; --text: #c5c6c7; --danger: #ff0000; }
        body { background-color: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; }
        
        /* SCROLLING TICKER */
        .ticker-wrap { width: 100%; background: #111; border-bottom: 1px solid #333; overflow: hidden; height: 30px; line-height: 30px; position: fixed; top: 0; z-index: 1000; }
        .ticker { display: inline-block; white-space: nowrap; animation: ticker 20s linear infinite; color: var(--primary); font-size: 0.9rem; font-family: monospace; }
        @keyframes ticker { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }

        .container { width: 90%; max-width: 900px; padding-top: 60px; padding-bottom: 50px; }
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { color: var(--primary); margin: 0; font-size: 2.5rem; text-transform: uppercase; letter-spacing: 2px; }
        
        .tab-btn { background: var(--card); border: 1px solid #333; color: white; padding: 10px 20px; cursor: pointer; border-radius: 5px; margin: 5px; }
        .tab-btn.active { background: var(--primary); color: black; font-weight: bold; }
        
        .search-box { background: var(--card); padding: 30px; border-radius: 15px; border: 1px solid #333; display: none; animation: fadeIn 0.5s; }
        .search-box.active { display: block; }
        
        input, textarea, select { width: 100%; background: #0b0c10; border: 1px solid #45a29e; color: white; padding: 15px; border-radius: 8px; margin-bottom: 15px; box-sizing: border-box; }
        button { width: 100%; padding: 15px; background: linear-gradient(45deg, #45a29e, #66fcf1); border: none; border-radius: 8px; font-weight: bold; cursor: pointer; color: #0b0c10; font-size: 1.1rem; }
        
        .verdict-card { padding: 20px; border-radius: 10px; border-left: 5px solid gray; background: var(--card); margin-bottom: 20px; }
        
        .radar-box { display: flex; gap: 10px; margin-top: 15px; }
        .radar-item { flex: 1; background: #111; padding: 10px; border-radius: 5px; font-size: 0.8rem; }
        .mini-progress { background: #333; height: 5px; border-radius: 3px; margin-top: 5px; overflow: hidden; }
        .mini-bar { height: 100%; width: 0%; background: #00f2ea; transition: width 1s; }

        .blockchain-data { background: #111; padding: 15px; border-radius: 8px; font-family: monospace; color: #00ff00; border: 1px dashed #444; word-break: break-all; margin-top: 15px; font-size: 0.9rem; }
        
        .stats-grid { display: flex; gap: 15px; margin-top: 20px; }
        .stat-card { flex: 1; background: #111; padding: 20px; border-radius: 10px; border: 1px solid #333; text-align: center; }
        .stat-val { font-size: 2rem; color: #00f2ea; font-weight: bold; }
        .stat-label { color: #aaa; font-size: 0.9rem; }
        .blink { animation: blinker 1.5s linear infinite; color: red; }
        @keyframes blinker { 50% { opacity: 0; } }

        @media print {
            .ticker-wrap, .tabs, .search-box > select, .search-box > input, .search-box > textarea, .search-box > button { display: none !important; }
            body { background: white; color: black; }
            .search-box { display: block !important; border: none; }
            .blockchain-data { color: black; border: 1px solid black; }
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="ticker-wrap">
    <div class="ticker">
        üö® LIVE THREATS: [BLOCKED] Phishing attempt from IP 104.22.x.x (Russia) ‚Ä¢ [VERIFIED] News confirmed Authentic ‚Ä¢ [BLOCKED] Scam detected ‚Ä¢ [ALERT] New Deepfake signature added...
    </div>
</div>

<div class="container">
    <div class="header">
        <h1>TrustLens</h1>
        <p>National Threat Intelligence & Verification Platform</p>
    </div>

    <div style="text-align: center; margin-bottom: 20px;" class="tabs">
        <button class="tab-btn active" onclick="switchTab('analyze')">üîç Threat Scanner</button>
        <button class="tab-btn" onclick="switchTab('lookup')">üîó Ledger Audit</button>
        <button class="tab-btn" onclick="switchTab('stats')">üìä System Status</button>
    </div>

    <div id="analyzeTab" class="search-box active">
        <select id="inputType" onchange="toggleInput()">
            <option value="text">Paste Text</option>
            <option value="url">Paste URL</option>
        </select>
        
        <textarea id="newsInput" placeholder="Enter content to verify..."></textarea>
        <input type="text" id="urlInput" placeholder="https://..." style="display: none;">
        
        <button onclick="verifyNews()">INITIATE SCAN</button>

        <div id="resultArea" style="display: none; margin-top: 20px;">
            <div class="verdict-card" id="verdictCard">
                <h2 id="predictionResult">Processing...</h2>
                <div style="display: flex; justify-content: space-between;">
                    <span id="confidenceScore"></span>
                    <span id="serverLocation" style="color: #aaa; font-size: 0.9rem;">üìç Locating...</span>
                </div>
                <div style="background: #333; height: 10px; border-radius: 5px; margin-top: 10px; overflow: hidden;">
                    <div id="visualConfidence" style="height: 100%; width: 0%; background: #00f2ea; transition: width 1s;"></div>
                </div>

                <div class="radar-box">
                    <div class="radar-item">
                        <span>üò° Emotional Intensity</span>
                        <div class="mini-progress"><div id="barSentiment" class="mini-bar"></div></div>
                    </div>
                    <div class="radar-item">
                        <span>‚öñÔ∏è Subjective Bias</span>
                        <div class="mini-progress"><div id="barBias" class="mini-bar" style="background: #ff4d4d;"></div></div>
                    </div>
                </div>
            </div>
            
            <div style="background: #1a1a2e; padding: 15px; border-radius: 10px; border: 1px solid #45a29e;">
                <strong>ü§ñ Intelligence Brief:</strong>
                <p id="aiExplanation" style="color: #e0e0e0; font-style: italic;"></p>
                <hr style="border-color: #333;">
                <strong>üåç Sources / Action:</strong>
                <div id="sourcesList" style="margin-top: 10px;"></div>
            </div>

            <div class="blockchain-data">
                <strong>‚õìÔ∏è IMMUTABLE PROOF:</strong><br>
                <span style="color: #888;">Hash:</span> <span id="blockHash">...</span><br>
                <span style="color: #888;">Abstract:</span> <span id="storedAbstract" style="color: #fff; font-weight: bold;">...</span>
            </div>

            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button onclick="downloadReport()" style="background: #fff; color: #000; border: 2px solid #ccc; flex: 1;">üì• DOWNLOAD REPORT</button>
                <button onclick="shareWhatsapp()" style="background: #25D366; color: #fff; border: none; flex: 1;">üí¨ SHARE ALERT</button>
            </div>
        </div>
    </div>

    <div id="lookupTab" class="search-box">
        <h3>Ledger Audit</h3>
        <p>Verify data integrity against the blockchain.</p>
        <input type="text" id="hashInput" placeholder="Hash ID...">
        <button onclick="lookupHash()">RETRIEVE</button>
        <div id="lookupArea" style="display: none; margin-top: 20px;">
             <div class="blockchain-data" id="lookupData" style="color: #00ff00;"></div>
        </div>
    </div>

    <div id="statsTab" class="search-box">
        <h3>Network Command Center</h3>
        <div class="stats-grid">
            <div class="stat-card"><div class="stat-val" id="statScans">0</div><div class="stat-label">Scans Today</div></div>
            <div class="stat-card"><div class="stat-val blink" style="color: red;" id="statThreats">0</div><div class="stat-label">Threats Blocked</div></div>
            <div class="stat-card"><div class="stat-val" style="color: #00ff00;" id="statDefcon">LEVEL 5</div><div class="stat-label">DEFCON Level</div></div>
        </div>
        <div style="background: #111; padding: 20px; border-radius: 10px; margin-top: 20px; border: 1px solid #333;">
            <strong>üñ•Ô∏è Active Node Log:</strong><br>
            <code style="color: #00f2ea; display: block; margin-top: 10px;">
                > Node-Alpha (Mumbai): ONLINE<br>> Neural Engine: ACTIVE [Gemini-2.5-Flash]
            </code>
        </div>
    </div>
</div>

<script>
    function switchTab(tab) {
        ['analyze', 'lookup', 'stats'].forEach(t => document.getElementById(t+'Tab').style.display = 'none');
        document.getElementById(tab+'Tab').style.display = 'block';
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
        if(tab === 'stats') updateStats();
    }
    
    function toggleInput() {
        const isUrl = document.getElementById('inputType').value === 'url';
        document.getElementById('newsInput').style.display = isUrl ? 'none' : 'block';
        document.getElementById('urlInput').style.display = isUrl ? 'block' : 'none';
        document.getElementById('newsInput').value = '';
        document.getElementById('urlInput').value = '';
    }

    function downloadReport() { window.print(); }
    function shareWhatsapp() { window.open(`https://wa.me/?text=Threat%20Alert!`, '_blank'); }

    async function updateStats() {
        try {
            const res = await fetch('/stats');
            const data = await res.json();
            document.getElementById('statScans').innerText = data.scans_today || 0;
            document.getElementById('statThreats').innerText = data.threats_blocked || 0;
            document.getElementById('statDefcon').innerText = data.defcon || "LEVEL 5";
        } catch(e) {}
    }

    async function verifyNews() {
        const type = document.getElementById('inputType').value;
        const payload = type === 'text' ? document.getElementById('newsInput').value.trim() : document.getElementById('urlInput').value.trim();
        
        if(!payload) return alert("Please enter text or a URL to verify.");

        const btn = document.querySelector('#analyzeTab button');
        btn.innerText = "Scanning Global Nodes...";
        btn.disabled = true;

        try {
            const res = await fetch('/verify', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({text: payload, type: type})
            });
            const data = await res.json();

            document.getElementById('resultArea').style.display = 'block';
            document.getElementById('predictionResult').innerText = data.prediction;
            document.getElementById('confidenceScore').innerText = `Confidence: ${data.confidence}`;
            document.getElementById('aiExplanation').innerText = data.explanation;
            document.getElementById('serverLocation').innerText = `üìç Server: ${data.server_location}`;
            document.getElementById('blockHash').innerText = data.block_hash;
            document.getElementById('storedAbstract').innerText = `"${data.stored_abstract}"`;

            let color = "#00f2ea"; 
            if (data.prediction === "Fake") color = "#ff4d4d"; 
            if (data.prediction === "Malicious") color = "#ff0000"; 

            document.getElementById('verdictCard').style.borderLeftColor = color;
            document.getElementById('predictionResult').style.color = color;
            document.getElementById('visualConfidence').style.width = parseFloat(data.confidence) + "%";
            document.getElementById('visualConfidence').style.backgroundColor = color;
            document.getElementById('barSentiment').style.width = (data.sentiment || 0) + "%";
            document.getElementById('barBias').style.width = (data.bias || 0) + "%";

            // Process Links
            const list = document.getElementById('sourcesList');
            if(data.cyber_report_id) {
                list.innerHTML = `<div style="background: rgba(255,0,0,0.1); border: 1px solid red; padding: 10px; border-radius: 5px;"><span style="color: red; font-weight: bold;">üö® THREAT REPORT GENERATED</span><br><span style="color: #ccc; font-size: 0.8rem;">ID: ${data.cyber_report_id}</span></div>`;
            } else if (data.sources && data.sources.length > 0) {
                list.innerHTML = `<ul style="list-style: none; padding-left: 0;">` + data.sources.map(s => `
                    <li style="margin-bottom: 8px;">
                        <a href="${s.url}" target="_blank" style="color: #00f2ea; text-decoration: none; font-weight: bold; border-bottom: 1px dotted #00f2ea;">
                            üîó ${s.title}
                        </a>
                    </li>
                `).join('') + `</ul>`;
            } else {
                list.innerHTML = `<div style="color: #aaa; font-style: italic;">No specific web sources found.</div>`;
            }
        } catch(e) { alert("Connection to Neural Engine failed. Check backend."); }
        
        btn.innerText = "INITIATE SCAN";
        btn.disabled = false;
        updateStats();
    }

    async function lookupHash() {
        const hashVal = document.getElementById('hashInput').value.trim();
        if(!hashVal) return alert("Enter a Hash ID");
        
        try {
            const res = await fetch('/lookup', { 
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({hash: hashVal})
            });
            
            const data = await res.json();
            document.getElementById('lookupArea').style.display = 'block';
            
            if (data.found) {
                let displayHtml = `<strong>Block:</strong> ${data.block_index}<br><strong>Timestamp:</strong> ${new Date(data.timestamp * 1000).toLocaleString()}<br><br>`;
                if (data.tampered) {
                    displayHtml += `<span style="color: red; font-weight: bold; border: 1px solid red; padding: 5px;">üö® WARNING: LEDGER TAMPERING DETECTED üö®<br>The data in this block does not match its cryptographic hash.</span><br><br>`;
                } else {
                    displayHtml += `<span style="color: #00ff00; font-weight: bold;">‚úÖ LEDGER VERIFIED: Cryptographic hash is intact.</span><br><br>`;
                }
                displayHtml += `<strong>Data:</strong><br><pre style="white-space: pre-wrap; margin:0;">${data.transactions ? JSON.stringify(data.transactions, null, 2) : "Data payload secured."}</pre>`;
                document.getElementById('lookupData').innerHTML = displayHtml;
                document.getElementById('lookupData').style.color = data.tampered ? "#ff4d4d" : "#00ff00";
            } else {
                document.getElementById('lookupData').innerHTML = `<span style="color: red;">Error: ${data.message}</span>`;
            }
        } catch(e) { alert("Connection to Ledger failed."); }
    }
    
    updateStats();
</script>
</body>
</html>